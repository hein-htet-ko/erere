<script>
  window.addEventListener('load', () => {
    const startButton = document.getElementById('startButton');
    const startOverlay = document.getElementById('start-overlay');
    const invitationContainer = document.getElementById('invitation-container');
    const bgMusic = document.getElementById('bg-music');
    const quotes = document.querySelectorAll('.quote');
    const images = document.querySelectorAll('img');
    const closingText = document.getElementById('closing-text');
    let isScrolling = false;
    let scrollSpeed = 1.2; // Slightly faster for mobile, tweak as needed
    let scrollTimer = null;

    // Detect mobile device
    function isMobile() {
      return /Android|iPhone|iPad|iPod|Opera Mini|IEMobile|WPDesktop/i.test(navigator.userAgent);
    }

    // Floating hearts generator
    function createHeart() {
      const heart = document.createElement('div');
      heart.classList.add('floating-heart');
      heart.innerHTML = Math.random() > 0.5 ? 'ðŸ’–' : 'â¤ï¸';
      heart.style.left = Math.random() * 100 + 'vw';
      heart.style.fontSize = (20 + Math.random() * 20) + 'px';
      document.getElementById('hearts-container').appendChild(heart);
      setTimeout(() => heart.remove(), 6000);
    }

    // Falling petals generator
    function createPetal() {
      const petal = document.createElement('div');
      petal.classList.add('petal');
      petal.innerHTML = 'ðŸŒ¸';
      petal.style.left = Math.random() * 100 + 'vw';
      petal.style.fontSize = (18 + Math.random() * 12) + 'px';
      petal.style.animationDuration = (6 + Math.random() * 4) + 's';
      document.getElementById('petals-container').appendChild(petal);
      setTimeout(() => petal.remove(), 10000);
    }

    // Auto Scroll
    function doAutoScroll() {
      if (!isScrolling) return;
      const currentScroll = window.scrollY;
      const maxScroll = document.documentElement.scrollHeight - window.innerHeight;

      // reveal quotes and images
      [...quotes, ...images].forEach(el => {
        const rect = el.getBoundingClientRect();
        if (rect.top < window.innerHeight * 0.85) {
          el.classList.add('visible');
        }
      });

      if (currentScroll >= maxScroll - 2) {
        isScrolling = false;
        closingText.classList.add('opacity-100');
        return;
      }
      window.scrollBy(0, scrollSpeed);

      // Fallback: use setTimeout for mobile, requestAnimationFrame otherwise
      if (isMobile()) {
        scrollTimer = setTimeout(doAutoScroll, 16); // ~60fps
      } else {
        requestAnimationFrame(doAutoScroll);
      }
    }

    // On start
    startButton.addEventListener('click', () => {
      window.scrollTo(0, 0);
      startOverlay.classList.add('opacity-0');
      setTimeout(() => {
        startOverlay.style.display = 'none';
        document.body.style.overflowY = 'auto';
        invitationContainer.classList.remove('opacity-0');
        invitationContainer.classList.add('opacity-100');

        // Music fade-in
        bgMusic.volume = 0;
        bgMusic.play().catch(()=>{});
        let vol = 0;
        let fadeIn = setInterval(() => {
          if (vol < 1) {
            vol += 0.02;
            bgMusic.volume = Math.min(vol, 1);
          } else clearInterval(fadeIn);
        }, 200);

        // Start floating hearts & petals
        setInterval(createHeart, 1200);
        setInterval(createPetal, 1500);

        // Start auto scroll after gesture
        isScrolling = true;
        doAutoScroll();

        // Extra: On iOS, if user touches the screen, keep autoscrolling active
        if (isMobile()) {
          window.addEventListener('touchstart', () => {
            if (!isScrolling) {
              isScrolling = true;
              doAutoScroll();
            }
          });
        }

      }, 1000);
    });

    // Clear timer on manual scroll/touch end (optional: for polish)
    window.addEventListener('touchend', () => {
      if (isScrolling && isMobile()) {
        clearTimeout(scrollTimer);
        scrollTimer = null;
        isScrolling = false;
        setTimeout(() => {
          isScrolling = true;
          doAutoScroll();
        }, 400);
      }
    });
  });
</script>
